# scripts/update_trends.py
"""
–û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–Ω–¥–æ–≤:
1. –ü–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å GitHub
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ –ë–î
3. –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π) –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
4. –û–±–Ω–æ–≤–ª—è–µ—Ç README.md —Å —Ç–æ–ø–æ–º —Ç—Ä–µ–Ω–¥–æ–≤
"""

import sys
import os
sys.path.append(os.path.dirname(__file__))

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à–∏ –º–æ–¥—É–ª–∏
from fetch_github_repos import get_devops_repos
from db import init_db, save_repos, cleanup_old


def main():
    print("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...")
    init_db()

    print("üßπ –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)...")
    cleanup_old()

    print("üì° –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö DevOps-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ —Å GitHub...")
    repos = get_devops_repos()

    print(f"üì• –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ {len(repos)} —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –≤ –ë–î...")
    save_repos(repos)

    # --- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ ---
    from vector_search import get_trending_repos
    print("\nüß† –í—ã–ø–æ–ª–Ω—è–µ–º —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤...")
    trending = get_trending_repos(limit=5)
    print(f"üèÜ –ù–∞–π–¥–µ–Ω–æ {len(trending)} —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤:")
    for repo in trending:
        print(f"  - {repo['name']} ({repo['stars']} ‚≠ê)")
    # --- –ö–æ–Ω–µ—Ü –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ ---

    # --- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ README.md ---
    from readme_updater import update_readme
    print("\n‚úçÔ∏è  –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ README.md...")
    update_readme(trending)
    print("üìÑ README.md –æ–±–Ω–æ–≤–ª—ë–Ω.")
    # --- –ö–æ–Ω–µ—Ü –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è README ---

    print("\n‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–µ—Ä—à–µ–Ω–æ.")


if __name__ == "__main__":
    main()